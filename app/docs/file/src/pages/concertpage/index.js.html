<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../../">
  <title data-ice="title">src/pages/concertpage/index.js | app</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/App.js~App.html">App</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-register">register</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-unregister">unregister</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-database">database</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-firebaseApp">firebaseApp</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-allfestivals">components/allfestivals</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/allfestivals/AllFestivals.js~AllFestivals.html">AllFestivals</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-artist">components/artist</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/artist/Artist.js~Artist.html">Artist</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-artist-pr">components/artist_pr</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/artist_pr/ArtistPR.js~ArtistPR.html">ArtistPR</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-artistlist">components/artistlist</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/artistlist/ArtistList.js~ArtistList.html">ArtistList</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-concertprogram">components/concertprogram</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/concertprogram/ConcertProgram.js~ConcertProgram.html">ConcertProgram</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-createday">components/createday</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/createday/CreateDay.js~CreateDay.html">CreateDay</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-createddays">components/createddays</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/createddays/CreatedDays.js~CreatedDays.html">CreatedDays</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-createfestival">components/createfestival</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/createfestival/CreateFestival.js~CreateFestival.html">CreateFestival</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-createscene">components/createscene</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/createscene/CreateScene.js~CreateScene.html">CreateScene</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-festival">components/festival</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/festival/Festival.js~Festival.html">Festival</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-managerequest">components/managerequest</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/managerequest/ManageRequest.js~ManageRequest.html">ManageRequest</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-navbar">components/navbar</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/navbar/navbar.js~NavComponent.html">NavComponent</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-programdays">components/programdays</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/programdays/ProgramDays.js~ProgramDays.html">ProgramDays</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-programslots">components/programslots</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/programslots/ProgramSlots.js~ProgramSlots.html">ProgramSlots</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-scenelist">components/scenelist</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/scenelist/SceneList.js~SceneList.html">SceneList</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-slots">components/slots</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/slots/Slots.js~Slots.html">Slots</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-technicianslist">components/technicianslist</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/technicianslist/TechniciansList.js~TechniciansList.html">TechniciansList</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#pages-adminpage">pages/adminpage</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/pages/adminpage/index.js~AdminPage.html">AdminPage</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#pages-artists">pages/artists</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/pages/artists/index.js~Artists.html">Artists</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#pages-bandbooking">pages/bandbooking</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/pages/bandbooking/index.js~BandBooking.html">BandBooking</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#pages-bandbookingresponsible">pages/bandbookingresponsible</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/pages/bandbookingresponsible/index.js~BandBookingResponsible.html">BandBookingResponsible</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#pages-banddatabase">pages/banddatabase</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/pages/banddatabase/index.js~BandDatabase.html">BandDatabase</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#pages-concertpage">pages/concertpage</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/pages/concertpage/index.js~ConcertPage.html">ConcertPage</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#pages-frontpage">pages/frontpage</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/pages/frontpage/index.js~FrontPage.html">FrontPage</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#pages-homepage">pages/homepage</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/pages/homepage/index.js~HomePage.html">HomePage</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#pages-login">pages/login</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/pages/login/index.js~Login.html">Login</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#pages-manager-site">pages/manager_site</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/pages/manager_site/index.js~ManagerSite.html">ManagerSite</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#pages-pr-site">pages/pr_site</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/pages/pr_site/index.js~PrSite.html">PrSite</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#pages-pricecalculator">pages/pricecalculator</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/pages/pricecalculator/index.js~PriceCalculator.html">PriceCalculator</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#pages-search">pages/search</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/pages/search/index.js~Search.html">Search</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#pages-setup">pages/setup</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/pages/setup/index.js~Setup.html">Setup</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#pages-technicians">pages/technicians</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/pages/technicians/index.js~Technicians.html">Technicians</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/pages/concertpage/index.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import React, { Component } from &apos;react&apos;;

import &apos;./style.css&apos;;
import template from &apos;../../static/img/defaultArtistPic.jpg&apos;

//firebase
import database from &apos;../../database&apos;

/**
 * Component used to render the concerts page 
 */
export default class ConcertPage extends Component {
  
  constructor() {
    super();

    this.state = {
      concerts: [],
      opts: [],
      selectedTech: &quot;showAll&quot;,
      selectedTechName: &quot;All Concerts&quot;,
    }

    this.handleChange = this.handleChange.bind(this);

  }

  /**
   * Pulls information from database
   */
  componentWillMount() {
    var previousConcerts = this.state.concerts;
    var previousOpts = this.state.opts;
    var previousSelectedTech = this.state.selectedTech;
    
    // Spagetti-kode
    database.ref(this.props.state.festival).child(&apos;concerts&apos;).orderByChild(&apos;day&apos;).on(&apos;child_added&apos;, concertSnapshot =&gt; {
      database.ref(this.props.state.festival).child(&quot;scenes&quot;).orderByKey().equalTo(concertSnapshot.val().scene).once(&quot;value&quot;, foundScenes =&gt; {
        
        //.equalTo returnerer en samling av dataSnapshots, enkleste m&#xE5;ten er &#xE5; kj&#xF8;re child p&#xE5; den
        // og keyen til childen vi er ute etter er keyen som ligger i concertSnapshotet
        var sceneName = foundScenes.child(concertSnapshot.val().scene).val().name;
        var sceneCapacity = foundScenes.child(concertSnapshot.val().scene).val().capacity;
        

        var vals = concertSnapshot.val();
        var prevTechnicianNames = [];
        concertSnapshot.child(&apos;technicians&apos;).forEach((technician) =&gt; {
          prevTechnicianNames.push(technician.val().name)
        })
        previousConcerts.push({
          name: vals.name,
          genres: vals.genres,
          price: vals.price,
          day: vals.day,
          key: concertSnapshot.key,
          technicians: vals.technicians,
          technicianNames: prevTechnicianNames,
          requirements: vals.requirements,
          pic: vals.pic,
          rider: vals.rider,
          sceneName: sceneName,
          sceneCapacity: sceneCapacity,
        })
      this.setState({
        concerts: previousConcerts,
        selectedTech: previousSelectedTech,
        technicianNames: prevTechnicianNames,
      })
    })

    database.ref(this.props.state.festival).child(&apos;technicians&apos;).orderByChild(&apos;ID&apos;).on(&apos;child_added&apos;, technicianSnapshot =&gt; {
      previousOpts.push(
        &lt;option id=&quot;dropdownItem&quot; onClick={this.handleChange} key={technicianSnapshot.key} value={technicianSnapshot.key+&quot;:&quot;+technicianSnapshot.val().name}&gt; {technicianSnapshot.val().name} &lt;/option&gt;
      )
      this.setState({        
        opts: previousOpts,
      })
    })
  })
}

  /**
   * Keeps state synced to fields
   * @param {event} e 
   */
  handleChange(e) {
    this.setState({
      selectedTech: e.target.value.split(&quot;:&quot;)[0],
      selectedTechName: e.target.value.split(&quot;:&quot;)[1],
    })
    console.log(&quot;Selected tech set to: &quot; + e.target.value)
  }

  /**
   * Renders the page
   */
  render() {
    return (
      &lt;div className=&quot;container&quot;&gt;

        &lt;section className=&quot;jumbotron text-center&quot;&gt;
          &lt;div className=&quot;container&quot;&gt;
            &lt;h1 className=&quot;jumbotron-heading&quot;&gt;Concerts&lt;/h1&gt;
            &lt;p className=&quot;lead text-muted&quot;&gt;Filter concerts by technician&lt;/p&gt;
            &lt;div className=&quot;dropdown&quot;&gt;
            &lt;button className=&quot;btn btn-secondary dropdown-toggle&quot; type=&quot;button&quot; id=&quot;dropdownMenuButton&quot; data-toggle=&quot;dropdown&quot; aria-haspopup=&quot;true&quot; aria-expanded=&quot;false&quot;&gt;
              {this.state.selectedTechName}
            &lt;/button&gt;
            &lt;div className=&quot;dropdown-menu&quot; aria-labelledby=&quot;dropdownMenuButton&quot;&gt;
              &lt;option id=&quot;dropdownItem&quot; onClick={this.handleChange} value={&quot;showAll:All Concerts&quot;} key={&quot;showAll&quot;}&gt; All Concerts &lt;/option&gt;
              {this.state.opts}
            &lt;/div&gt;
            &lt;/div&gt;
          &lt;/div&gt;
        &lt;/section&gt;    




        &lt;div id=&quot;accordion&quot; role=&quot;tablist&quot;&gt;
          {
            this.state.concerts.map((concert, concertNum) =&gt; {
              let match = false;
              
              // Sjekk om alle skal vises
              if (this.state.selectedTech === &quot;showAll&quot;) {
                match = true;
              }

              // Hvis ikke, sjekk om konserten har noen teknikere p&#xE5; seg
              else if (concert.technicians !== undefined) {
                if (concert.technicians[this.state.selectedTech] !== undefined) {
                  match = true;
                }

              }

              if (match) {
                return (
                &lt;div className=&quot;card&quot; key={concert.key}&gt;
                  &lt;div className=&quot;card-header&quot; role=&quot;tab&quot; id={&quot;heading&quot;+concertNum}&gt;
                    &lt;h5 className=&quot;mb-0&quot;&gt;
                      &lt;a data-toggle=&quot;collapse&quot; href={&quot;#collapse&quot;+concertNum} aria-expanded=&quot;false&quot; aria-controls={&quot;collapse&quot;+concertNum}&gt;
                        {concert.name}
                      &lt;/a&gt;
                    &lt;/h5&gt;
                  &lt;/div&gt;
              
                  &lt;div id={&quot;collapse&quot;+concertNum} className=&quot;collapse&quot; role=&quot;tabpanel&quot; aria-labelledby={&quot;heading&quot;+concertNum}&gt;
                    &lt;div className=&quot;card-body&quot;&gt;
                      &lt;h6&gt;{concert.day}&lt;/h6&gt;
                      &lt;img src={concert.pic ? concert.pic : template} className=&quot;rounded float-left&quot; alt=&quot;Bilde av artist&quot;/&gt;
                      &lt;div className=&quot;float-center&quot;&gt;
                        &lt;br&gt;&lt;/br&gt;
                        &lt;h6&gt; Genres: {concert.genres} &lt;/h6&gt;
                        &lt;h6&gt; Scene: {concert.sceneName} &lt;/h6&gt;
                        &lt;h6&gt; Scene Capacity: {concert.sceneCapacity} &lt;/h6&gt;
                        &lt;h6&gt; Technical Requirements : {concert.requirements ? concert.requirements : &quot;None&quot;} &lt;/h6&gt;
                        &lt;h6&gt; Rider: {concert.rider ? concert.rider : &quot;None&quot;} &lt;/h6&gt;
                      &lt;/div&gt;
                      &lt;ul className=&quot;list-group list-group-flush float-right&quot;&gt;
                        &lt;h6&gt; Technicians on this concert &lt;/h6&gt;
                        {
                          concert.technicianNames.map(tech =&gt; {
                            console.log(&quot;Tech&quot;, tech)
                            return (
                              &lt;li className=&quot;list-group-item&quot;&gt; {tech} &lt;/li&gt;
                            )
                          })
                        }
                      &lt;/ul&gt;
                    &lt;/div&gt;
                  &lt;/div&gt;
                &lt;/div&gt;
              )
            }
          })
        }
        &lt;/div&gt;
      &lt;/div&gt;
    );
  }
}
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.0.4)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
