<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../../">
  <title data-ice="title">src/pages/technicians/index.js | app</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/App.js~App.html">App</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-register">register</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-unregister">unregister</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-database">database</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-firebaseApp">firebaseApp</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-allfestivals">components/allfestivals</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/allfestivals/AllFestivals.js~AllFestivals.html">AllFestivals</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-artist">components/artist</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/artist/Artist.js~Artist.html">Artist</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-artist-pr">components/artist_pr</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/artist_pr/ArtistPR.js~ArtistPR.html">ArtistPR</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-artistlist">components/artistlist</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/artistlist/ArtistList.js~ArtistList.html">ArtistList</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-concertprogram">components/concertprogram</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/concertprogram/ConcertProgram.js~ConcertProgram.html">ConcertProgram</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-createday">components/createday</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/createday/CreateDay.js~CreateDay.html">CreateDay</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-createddays">components/createddays</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/createddays/CreatedDays.js~CreatedDays.html">CreatedDays</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-createfestival">components/createfestival</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/createfestival/CreateFestival.js~CreateFestival.html">CreateFestival</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-createscene">components/createscene</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/createscene/CreateScene.js~CreateScene.html">CreateScene</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-festival">components/festival</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/festival/Festival.js~Festival.html">Festival</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-managerequest">components/managerequest</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/managerequest/ManageRequest.js~ManageRequest.html">ManageRequest</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-navbar">components/navbar</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/navbar/navbar.js~NavComponent.html">NavComponent</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-programdays">components/programdays</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/programdays/ProgramDays.js~ProgramDays.html">ProgramDays</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-programslots">components/programslots</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/programslots/ProgramSlots.js~ProgramSlots.html">ProgramSlots</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-scenelist">components/scenelist</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/scenelist/SceneList.js~SceneList.html">SceneList</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-slots">components/slots</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/slots/Slots.js~Slots.html">Slots</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-technicianslist">components/technicianslist</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/technicianslist/TechniciansList.js~TechniciansList.html">TechniciansList</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#pages-adminpage">pages/adminpage</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/pages/adminpage/index.js~AdminPage.html">AdminPage</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#pages-artists">pages/artists</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/pages/artists/index.js~Artists.html">Artists</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#pages-bandbooking">pages/bandbooking</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/pages/bandbooking/index.js~BandBooking.html">BandBooking</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#pages-bandbookingresponsible">pages/bandbookingresponsible</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/pages/bandbookingresponsible/index.js~BandBookingResponsible.html">BandBookingResponsible</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#pages-banddatabase">pages/banddatabase</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/pages/banddatabase/index.js~BandDatabase.html">BandDatabase</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#pages-concertpage">pages/concertpage</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/pages/concertpage/index.js~ConcertPage.html">ConcertPage</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#pages-frontpage">pages/frontpage</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/pages/frontpage/index.js~FrontPage.html">FrontPage</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#pages-homepage">pages/homepage</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/pages/homepage/index.js~HomePage.html">HomePage</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#pages-login">pages/login</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/pages/login/index.js~Login.html">Login</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#pages-manager-site">pages/manager_site</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/pages/manager_site/index.js~ManagerSite.html">ManagerSite</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#pages-pr-site">pages/pr_site</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/pages/pr_site/index.js~PrSite.html">PrSite</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#pages-pricecalculator">pages/pricecalculator</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/pages/pricecalculator/index.js~PriceCalculator.html">PriceCalculator</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#pages-search">pages/search</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/pages/search/index.js~Search.html">Search</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#pages-setup">pages/setup</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/pages/setup/index.js~Setup.html">Setup</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#pages-technicians">pages/technicians</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/pages/technicians/index.js~Technicians.html">Technicians</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/pages/technicians/index.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import React, { Component } from &apos;react&apos;;


import &apos;./style.css&apos;;

import Technician from &apos;../../components/technician/Technician&apos;
import Concert from &apos;../../components/concert/Concert&apos;
import TechniciansList from &apos;../../components/technicianslist/TechniciansList&apos;

//Firebase
import database from &apos;../../database&apos;
//region
/**
 * Component that renders the technicians page 
 */
export default class Technicians extends Component {
//endregion
  constructor(props) {
    super(props);
    var technicianMap = new Map();

    this.state = {
      technicians: [],
      concertOptions: [],
      technicianOptions: [],
      selectedConcert: &quot;&quot;,
      selectedTechnician: &quot;&quot;,
      technicianMap: technicianMap,

      // Technician form
      currentTechnicianConcert: &quot;&quot;,
      currentTechnicianNameInput: &quot;&quot;,
      currentTechnicianIdInput: &quot;&quot;,

      // Concert form
      artists: [],
      currentConcertNameInput: &quot;&quot;,
      currentConcertGenreInput: &quot;&quot;,
      currentConcertInput: &quot;&quot;,
      currentConcertPriceInput: &quot;&quot;,
      currentConcertContactInfo: &quot;&quot;,
      currentConcertSalesNumber: &quot;&quot;,
      currentConcertDayInput: &quot;&quot;,

    }



    this.match = &quot;&quot;;
    this.handleChange = this.handleChange.bind(this);
    this.pushTech = this.pushTech.bind(this);
    this.handleSubmitTech = this.handleSubmitTech.bind(this);
    this.searchConcertsFor = this.searchConcertsFor.bind(this);
    this.isTechInConcert = this.isTechInConcert.bind(this);
  }

  /**
   * Pulls information from the database
   */
  componentWillMount() {
    var previousTechnicians = this.state.technicians;
    var previousConcertOptions = this.state.concertOptions;
    var previousTechnicianOptions = this.state.technicianOptions;
    var previousTechnicianMap = this.state.technicianMap;
    var previousArtists = this.state.artists;

    // User Form
    var previousUserOptions = this.state.userOptions;

    var firstConcert = &quot;&quot;
    database.ref(this.props.state.festival).child(&apos;concerts&apos;).on(&apos;child_added&apos;, concertSnapshot =&gt; {
      console.log(concertSnapshot.val().name)
      console.log(concertSnapshot.key)
      previousConcertOptions.push(
        &lt;option label={concertSnapshot.val().name} value={concertSnapshot.key} key={concertSnapshot.key}&gt; {concertSnapshot.val().name} &lt;/option&gt;
        
      )
      if (! firstConcert) {
        firstConcert = concertSnapshot.key
      }
    })

    database.ref(this.props.state.festival).child(&apos;technicians&apos;).on(&apos;child_added&apos;, techSnapshot =&gt; {
      var val = techSnapshot.val();
      previousTechnicians.push({
        name: val.name,
        id: techSnapshot.key,
      })
      console.log(&apos;adding option for&apos;, techSnapshot.val().name)
      previousTechnicianOptions.push(
        &lt;option value={techSnapshot.key} key={techSnapshot.key}&gt; {techSnapshot.val().name} &lt;/option&gt;
      )
      previousTechnicianMap.set(techSnapshot.key, techSnapshot.val().name)
      this.setState({
        technicians: previousTechnicians,
        concertOptions: previousConcertOptions,
        technicianOptions: previousTechnicianOptions,
        technicianMap: previousTechnicianMap,
        currentTechnicianConcert: &quot;&quot;,
        currentTechnicianNameInput: &quot;&quot;,
        currentTechnicianIdInput: &quot;&quot;,
        selectedTechnician: techSnapshot.key, //set the selected to the one last added to prevent error if none i selected
        selectedConcert: firstConcert// Funket ikke: previousConcertOptions[0].value,
      })
    })

    // Henter ut artistene i databasen
    database.ref(this.props.state.festival).child(&apos;artists&apos;).on(&apos;child_added&apos;, artistSnapShot =&gt; {
      var val = artistSnapShot.val();
      previousArtists.push({
        name: val.name,
        id: artistSnapShot.key,
      })
    })

    //Lytter etter child added p&#xE5; tekniker, alts&#xE5; om tekniker blir lagt til
    // Den nye teknikeren vil ikke vises i dropdown f&#xF8;r componenten blir rendered p&#xE5; nytt. Dette for &#xE5; unng&#xE5; duplikater.
    database.ref(this.props.state.festival).child(&apos;technicians&apos;).orderByKey().limitToLast(1).on(&apos;child_added&apos;, lastTechnician =&gt; {
      console.log(lastTechnician.val().name +  &quot; added&quot;);
      var previousTechnicianMap = this.state.technicianMap;
      previousTechnicianMap.set(parseInt(lastTechnician.key), lastTechnician.val().name)

      this.setState({
        technicianOptions: previousTechnicianOptions,
        technicianMap: previousTechnicianMap,
      })
    })

   
  }

  /**
   * Keeps the state synced with fields
   * @param {event} e 
   */
  handleChange(e) {
    this.setState({
      [e.target.name]: e.target.value
    })
  }


  /**
   * Checks if technician is in concert
   */
  isTechInConcert() { 
    console.log(&quot;Running check: is tech already in concert?&quot;);
    console.log(&quot;Festivalkey:&quot;, this.props.state.festival, &quot;Selected concert:&quot;, this.state.selectedConcert)
    var isInConcert = false;
    var currentTechKey = this.state.selectedTechnician;

    // Returnerer en Promise. N&#xE5;r then() kj&#xF8;res sendes isInConcert gjennom denne Promisen
    return database.ref(this.props.state.festival).child(&apos;concerts&apos;).child(this.state.selectedConcert).child(&apos;technicians&apos;).once(&apos;value&apos;, techSnap =&gt; {
      techSnap.forEach(technician =&gt; {
        // Hvis denne teknikeren i konserten er den vi ser etter, er den i konserten
        if (technician.key === currentTechKey) {
          isInConcert = true
        }
      })
    })
    // N&#xE5;r databasegreiene er ferdig, returner isInConcert gjennom Promisen
    .then(() =&gt; {
      return isInConcert
    })
  }

  /**
   * Pushes technician into concert
   * @param {event} e 
   */
  pushTech(e) {
    e.preventDefault();

    // Kj&#xF8;r isTechInConcert, denne returnerer en Promise.
    // Promisen vi f&#xE5;r tilbake kan vi kalle .then() p&#xE5;. then() kj&#xF8;res n&#xE5;r Promisen blir &quot;resolved&quot; alts&#xE5; returnerer noe.
    // Da f&#xE5;r man ogs&#xE5; med variabelen(e) som ble returnert i Promisen.
    this.isTechInConcert()
    .then(isInConcert =&gt; {

     
      if (!isInConcert) {
        database.ref(this.props.state.festival).child(&apos;concerts&apos;).child(this.state.selectedConcert).child(&apos;technicians&apos;).child(this.state.selectedTechnician).set({
          name: this.state.technicianMap.get(this.state.selectedTechnician),
        })

        alert(this.state.technicianMap.get(this.state.selectedTechnician) + &quot; assigned to work on that concert&quot;)

      } else {
        alert(this.state.technicianMap.get(this.state.selectedTechnician) + &quot; is already assigned to that concert&quot;)
        console.log(&quot;Technician was already in concert&quot;)
      }
    })
  }

  


 
  /**
   * Pushes a new technician into the database
   * @param {event} e 
   */
  handleSubmitTech(e) {
    e.preventDefault();

    database.ref(this.props.state.festival).child(&apos;technicians&apos;).push({
      name: this.state.currentTechnicianNameInput
    })
    this.setState({ //setter input boksen tilbake til tom
      currentTechnicianNameInput: &quot;&quot;,
    })
  }

  

  /**
   * Generic function that searches concert query for value and sets this.match to concert that matches
   * @param {String} query 
   * @param {String} value 
   */
  searchConcertsFor(query, value) {
    return database.ref(this.props.state.festival).child(&apos;concerts&apos;).once(&apos;value&apos;).then(concertsSnapshot =&gt; {
      return concertsSnapshot.forEach(concertSnapshot =&gt; {
        if (concertSnapshot.val()[query] == value) {
          this.match = concertSnapshot;
          console.log(this.match);
        }
      })
    })
  }

  /**
   * Renders the page
   */
  render() {
    return (
      &lt;div className=&quot;App&quot;&gt;

        &lt;form&gt;
          &lt;h2&gt; Add Technician&lt;/h2&gt;
          &lt;input name=&quot;currentTechnicianNameInput&quot; type=&quot;text&quot; value={this.state.currentTechnicianNameInput} onChange={this.handleChange} placeholder=&quot;Technician Name&quot; /&gt;
          &lt;button onClick={this.handleSubmitTech}&gt;Add&lt;/button&gt;
        &lt;/form&gt;
        &lt;br&gt;&lt;/br&gt;
        
        &lt;table&gt;
          &lt;thead&gt;
                &lt;tr&gt;
                 &lt;th&gt;Technicians&lt;/th&gt;
                &lt;/tr&gt;
          &lt;/thead&gt;
          
          &lt;tbody&gt;
            &lt;tr&gt;
              {this.state.technicians.map((tech) =&gt; {
                      return(&lt;TechniciansList
                      name = {tech.name}
                      /&gt;)
                  })
              }
            &lt;/tr&gt;


          &lt;/tbody&gt;
        
        &lt;/table&gt;

        &lt;br&gt;&lt;/br&gt;
        &lt;form&gt;
          &lt;h2&gt;Assign to concert&lt;/h2&gt;
          &lt;select name=&quot;selectedTechnician&quot; onChange={this.handleChange} value={this.state.selectedTechnician}&gt;
            {this.state.technicianOptions}
          &lt;/select&gt;
          &lt;select name=&quot;selectedConcert&quot; onChange={this.handleChange} value={this.state.selectedConcert}&gt;
            {this.state.concertOptions}
          &lt;/select&gt;
          &lt;button onClick={this.pushTech}&gt;Assign&lt;/button&gt;
        &lt;/form&gt;

      &lt;/div&gt;
    );
  }
}
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.0.4)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
