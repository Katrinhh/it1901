<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../../">
  <title data-ice="title">src/pages/login/index.js | app</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/App.js~App.html">App</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-register">register</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-unregister">unregister</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-database">database</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-firebaseApp">firebaseApp</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-allfestivals">components/allfestivals</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/allfestivals/AllFestivals.js~AllFestivals.html">AllFestivals</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-artist">components/artist</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/artist/Artist.js~Artist.html">Artist</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-artist-pr">components/artist_pr</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/artist_pr/ArtistPR.js~ArtistPR.html">ArtistPR</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-artistlist">components/artistlist</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/artistlist/ArtistList.js~ArtistList.html">ArtistList</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-concertprogram">components/concertprogram</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/concertprogram/ConcertProgram.js~ConcertProgram.html">ConcertProgram</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-createday">components/createday</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/createday/CreateDay.js~CreateDay.html">CreateDay</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-createddays">components/createddays</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/createddays/CreatedDays.js~CreatedDays.html">CreatedDays</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-createfestival">components/createfestival</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/createfestival/CreateFestival.js~CreateFestival.html">CreateFestival</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-createscene">components/createscene</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/createscene/CreateScene.js~CreateScene.html">CreateScene</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-festival">components/festival</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/festival/Festival.js~Festival.html">Festival</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-managerequest">components/managerequest</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/managerequest/ManageRequest.js~ManageRequest.html">ManageRequest</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-navbar">components/navbar</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/navbar/navbar.js~NavComponent.html">NavComponent</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-programdays">components/programdays</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/programdays/ProgramDays.js~ProgramDays.html">ProgramDays</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-programslots">components/programslots</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/programslots/ProgramSlots.js~ProgramSlots.html">ProgramSlots</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-scenelist">components/scenelist</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/scenelist/SceneList.js~SceneList.html">SceneList</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-slots">components/slots</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/slots/Slots.js~Slots.html">Slots</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-technicianslist">components/technicianslist</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/technicianslist/TechniciansList.js~TechniciansList.html">TechniciansList</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#pages-adminpage">pages/adminpage</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/pages/adminpage/index.js~AdminPage.html">AdminPage</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#pages-artists">pages/artists</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/pages/artists/index.js~Artists.html">Artists</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#pages-bandbooking">pages/bandbooking</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/pages/bandbooking/index.js~BandBooking.html">BandBooking</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#pages-bandbookingresponsible">pages/bandbookingresponsible</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/pages/bandbookingresponsible/index.js~BandBookingResponsible.html">BandBookingResponsible</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#pages-banddatabase">pages/banddatabase</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/pages/banddatabase/index.js~BandDatabase.html">BandDatabase</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#pages-concertpage">pages/concertpage</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/pages/concertpage/index.js~ConcertPage.html">ConcertPage</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#pages-frontpage">pages/frontpage</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/pages/frontpage/index.js~FrontPage.html">FrontPage</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#pages-homepage">pages/homepage</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/pages/homepage/index.js~HomePage.html">HomePage</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#pages-login">pages/login</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/pages/login/index.js~Login.html">Login</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#pages-manager-site">pages/manager_site</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/pages/manager_site/index.js~ManagerSite.html">ManagerSite</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#pages-pr-site">pages/pr_site</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/pages/pr_site/index.js~PrSite.html">PrSite</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#pages-pricecalculator">pages/pricecalculator</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/pages/pricecalculator/index.js~PriceCalculator.html">PriceCalculator</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#pages-search">pages/search</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/pages/search/index.js~Search.html">Search</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#pages-setup">pages/setup</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/pages/setup/index.js~Setup.html">Setup</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#pages-technicians">pages/technicians</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/pages/technicians/index.js~Technicians.html">Technicians</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/pages/login/index.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import React, { Component } from &apos;react&apos;;
import &apos;./style.css&apos;;
import Artist from &apos;../../components/artist/Artist&apos;
import Concert from &apos;../../components/concert/Concert&apos;
import Technician from &apos;../../components/technician/Technician&apos;

// Firebase
import database, {firebaseApp} from &apos;../../database&apos;;

// React Router
import {Redirect} from &apos;react-router-dom&apos;;




/**
 * Unused Component to render the Login page
 */
class Login extends Component {
  constructor(props) {
    super(props);

    this.state = {
      email: &quot;&quot;,
      password: &quot;&quot;,
      errorCode: null,
      errorMessage: null,
      
      // Login
      loginOptions: [],
      selectedLogin: &quot;&quot;,
      user: null,
      redirectToReferrer: false,

    };

  }

  /**
   * Pulls the users and useroptions from the database
   */
  componentDidMount() {
    var previousLoginOptions = this.state.loginOptions
    var previousUser = this.state.user
    var previousSelectedLogin = this.state.selectedLogin

    database.ref(&apos;users&apos;).once(&apos;value&apos;, usersSnapshot =&gt; {
      usersSnapshot.forEach(userSnapshot =&gt; {
        previousLoginOptions.push(
          &lt;option value={userSnapshot.val().email} key={userSnapshot.key}&gt; {userSnapshot.val().displayName} &lt;/option&gt; 
        )

        if (! previousSelectedLogin) {
          previousSelectedLogin = userSnapshot.val().email
        }
      })
    }).then(() =&gt; {
      this.setState({
        loginOptions: previousLoginOptions,
        selectedLogin: previousSelectedLogin,
        user: previousUser
      })
    })
  }

  /**
   * Validates email and password
   */
  validateForm() {
    return this.state.email.length &gt; 0 &amp;&amp; this.state.password.length &gt; 0;
  }

  /**
   * Keeps state synced with fields
   */
  handleChange = event =&gt; {
    console.log(&quot;changing&quot;, event.target.name, &quot;to&quot;, event.target.value)
    this.setState({
      [event.target.name]: event.target.value
    });
  }

  /**
   * Signs up with email and password using firebase Auth
   */
  handleSignup = event =&gt; {
    event.preventDefault();

    firebaseApp.auth().createUserWithEmailAndPassword(this.state.email, this.state.password)
    .then(() =&gt; {
      this.setState({redirectToReferrer: true})
    })
    .catch(error =&gt; {
      this.handleError(error);
    })
  }

  /**
   * Signs in with email and password using firebase Auth
   */
  handleSignin = event =&gt; {
    event.preventDefault();

    firebaseApp.auth().signInWithEmailAndPassword(this.state.email, this.state.password)
    .then(() =&gt; {
      console.log(&quot;Signed In&quot;)
      this.setState({
        errorCode:null, 
        errorMessage:null,
        redirectToReferrer: true,
      })
    })
    .catch(error =&gt; {
      this.handleError(error);
    })
  }

  /**
   * Signs out from firebase auth
   */
  handleSignout = event =&gt; {
    event.preventDefault();

    firebaseApp.auth().signOut()
    .then(() =&gt; {
      console.log(&quot;Signed Out&quot;)
      this.forceUpdate()
    })
    .catch(error =&gt; {
      this.handleError(error);
    }) 
  }
  
  /**
   * Handles error. Sets state to reflect error and resets fields
   */
  handleError = error =&gt; {
    var errorCode = error.code;
    var errorMessage = error.message;
    console.log(errorCode, errorMessage)
    this.setState({
      errorCode: errorCode,
      errorMessage: errorMessage,
      email: &quot;&quot;,
      password: &quot;&quot;,
    })
  }

  /**
   * Changes user to the selected user, NOTE: Needs the password to be festival
   */
  changeUser = event =&gt; {
    event.preventDefault();

    // Logg inn med epost fra dropdown og passord festival (som er passordet til alle brukere jeg har lagt inn)
    firebaseApp.auth().signInWithEmailAndPassword(this.state.selectedLogin, &quot;festival&quot;)
    .then((user) =&gt; {
      console.log(&quot;Signed In as&quot;, user)
      this.setState({
        errorCode:null, 
        errorMessage:null,
        redirectToReferrer: true,
      })

    })
    .catch(error =&gt; {
      this.handleError(error);
    })

  }

  /**
   * Handles dropdown action, sets state to reflect chosen field
   */
  handleDropDown = (event, index, value) =&gt; {
    this.setState({
      selectedLogin: value
    })
  }

  /**
   * Renders the page
   */
  render() {
    const { from } = this.props.location.state || { from: { pathname: &apos;/&apos; } }

    if (this.state.redirectToReferrer) {
      return(
        &lt;Redirect to={from.pathname} /&gt;
      )
    }

    var error = &quot;&quot;
    // TODO: catch them all
    switch(this.state.errorCode) {
      case &quot;auth/user-not-found&quot;:
        error = &lt;h3 className=&quot;Error-message&quot;&gt; User not found &lt;/h3&gt;
        break;
      
      case &quot;auth/email-already-in-use&quot;:
        error = &lt;h3 className=&quot;Error-message&quot;&gt; This email is already in use &lt;/h3&gt;
        break; 

      default:
        error = &lt;h3&gt; {this.state.errorCode} &lt;/h3&gt;
        break;
    }

    var redirected = &quot;&quot;
    if (from.pathname !== &quot;/&quot;) {
      redirected = &lt;h3&gt; You don&apos;t have access to {from.pathname} &lt;/h3&gt;
    }

    return (
      &lt;div className=&quot;App&quot;&gt;

        &lt;h1 className=&quot;App-intro&quot;&gt;
          Login/Signup
        &lt;/h1&gt;

        &lt;div&gt;
        {
          error
        }
        {
          redirected
        }

        &lt;form className=&quot;form-signin&quot;&gt;
          &lt;h2 className=&quot;form-header&quot;&gt;Vennligst logg inn&lt;/h2&gt;
          &lt;label&gt;
            Email:
            &lt;input name=&quot;email&quot; type=&quot;email&quot; value={this.state.email} onChange={this.handleChange} /&gt;
          &lt;/label&gt;
          &lt;label&gt;
            Password:
            &lt;input name=&quot;password&quot; type=&quot;password&quot; value={this.state.password} onChange={this.handleChange} /&gt;
          &lt;/label&gt;
          &lt;button onClick={this.handleSignin}&gt;Sign in&lt;/button&gt;
          &lt;button onClick={this.handleSignout}&gt;Sign out&lt;/button&gt;
          &lt;button onClick={this.handleSignup}&gt;Sign up&lt;/button&gt;
        &lt;/form&gt;

        &lt;form&gt;
          &lt;h2&gt; Dropdown to select user &lt;/h2&gt;
          
          &lt;select name=&quot;selectedLogin&quot; value={this.state.selectedLogin} onChange={this.handleChange} &gt;
            {this.state.loginOptions}
          &lt;/select&gt;

          &lt;button onClick={this.changeUser}&gt;Change to&lt;/button&gt;

        &lt;/form&gt;
      &lt;/div&gt;
      &lt;/div&gt;
    );
  }
}

export default Login;
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.0.4)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
