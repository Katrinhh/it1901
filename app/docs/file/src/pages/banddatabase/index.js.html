<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../../">
  <title data-ice="title">src/pages/banddatabase/index.js | app</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/App.js~App.html">App</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-register">register</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-unregister">unregister</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-database">database</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-firebaseApp">firebaseApp</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-allfestivals">components/allfestivals</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/allfestivals/AllFestivals.js~AllFestivals.html">AllFestivals</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-artist">components/artist</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/artist/Artist.js~Artist.html">Artist</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-artist-pr">components/artist_pr</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/artist_pr/ArtistPR.js~ArtistPR.html">ArtistPR</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-artistlist">components/artistlist</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/artistlist/ArtistList.js~ArtistList.html">ArtistList</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-concertprogram">components/concertprogram</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/concertprogram/ConcertProgram.js~ConcertProgram.html">ConcertProgram</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-createday">components/createday</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/createday/CreateDay.js~CreateDay.html">CreateDay</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-createddays">components/createddays</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/createddays/CreatedDays.js~CreatedDays.html">CreatedDays</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-createfestival">components/createfestival</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/createfestival/CreateFestival.js~CreateFestival.html">CreateFestival</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-createscene">components/createscene</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/createscene/CreateScene.js~CreateScene.html">CreateScene</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-festival">components/festival</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/festival/Festival.js~Festival.html">Festival</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-managerequest">components/managerequest</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/managerequest/ManageRequest.js~ManageRequest.html">ManageRequest</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-navbar">components/navbar</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/navbar/navbar.js~NavComponent.html">NavComponent</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-programdays">components/programdays</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/programdays/ProgramDays.js~ProgramDays.html">ProgramDays</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-programslots">components/programslots</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/programslots/ProgramSlots.js~ProgramSlots.html">ProgramSlots</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-scenelist">components/scenelist</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/scenelist/SceneList.js~SceneList.html">SceneList</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-slots">components/slots</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/slots/Slots.js~Slots.html">Slots</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components-technicianslist">components/technicianslist</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/technicianslist/TechniciansList.js~TechniciansList.html">TechniciansList</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#pages-adminpage">pages/adminpage</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/pages/adminpage/index.js~AdminPage.html">AdminPage</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#pages-artists">pages/artists</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/pages/artists/index.js~Artists.html">Artists</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#pages-bandbooking">pages/bandbooking</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/pages/bandbooking/index.js~BandBooking.html">BandBooking</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#pages-bandbookingresponsible">pages/bandbookingresponsible</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/pages/bandbookingresponsible/index.js~BandBookingResponsible.html">BandBookingResponsible</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#pages-banddatabase">pages/banddatabase</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/pages/banddatabase/index.js~BandDatabase.html">BandDatabase</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#pages-concertpage">pages/concertpage</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/pages/concertpage/index.js~ConcertPage.html">ConcertPage</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#pages-frontpage">pages/frontpage</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/pages/frontpage/index.js~FrontPage.html">FrontPage</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#pages-homepage">pages/homepage</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/pages/homepage/index.js~HomePage.html">HomePage</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#pages-login">pages/login</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/pages/login/index.js~Login.html">Login</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#pages-manager-site">pages/manager_site</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/pages/manager_site/index.js~ManagerSite.html">ManagerSite</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#pages-pr-site">pages/pr_site</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/pages/pr_site/index.js~PrSite.html">PrSite</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#pages-pricecalculator">pages/pricecalculator</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/pages/pricecalculator/index.js~PriceCalculator.html">PriceCalculator</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#pages-search">pages/search</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/pages/search/index.js~Search.html">Search</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#pages-setup">pages/setup</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/pages/setup/index.js~Setup.html">Setup</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#pages-technicians">pages/technicians</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/pages/technicians/index.js~Technicians.html">Technicians</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/pages/banddatabase/index.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import React, { Component } from &apos;react&apos;;

import Concert from &apos;../../components/concert/Concert&apos;

import &apos;./style.css&apos;;

import database from &apos;../../database&apos;;

import defaultArtistPic from &apos;../../static/img/defaultArtistPic.jpg&apos;;


/**
 * Component used to render BandDatabase page
 */
export default class BandDatabase extends Component {

  constructor() {
    super();

    this.state = {
      concerts: [],
      scenes: [],
      genres: [],
      genreOptions: [],
      selectedGenre: &quot;All Genres&quot;,

      // Search
      currentSearchInput: &quot;&quot;,
    }

    this.handleSearch = this.handleSearch.bind(this);
    this.handleChange = this.handleChange.bind(this);
  }

  /**
   * Handles change in search, keeping state updated with the field
   * @param {event} e 
   */
  handleSearch(e) {
    e.preventDefault();
    this.setState({
      currentSearchInput: e.target.value
    })

  }

  /**
   * Keeps the state updated
   * @param {event} e 
   */
  handleChange(e) {
    e.preventDefault();
    this.setState({
      selectedGenre: e.target.value,
    })
    
  }

  /**
   * Pulls information from database
   */
  componentWillMount() {
    // Tar vare p&#xE5; current state
    var previousGenreOptions = this.state.genreOptions;
    var previousGenres = this.state.genres;
    var previousConcerts = this.state.concerts;
    var previousSceneMap = this.state.sceneMap;
    var previousScenes = this.state.scenes;
    var previousSceneOptions = this.state.sceneOptions;


    // G&#xE5; gjennom hele databasen
    database.ref().once(&apos;value&apos;, snapshot =&gt; {
      snapshot.forEach(festivalSnapshot =&gt; {

        if (festivalSnapshot.key.startsWith(&quot;-&quot;)) {
          // For hver konsert
          festivalSnapshot.child(&apos;concerts&apos;).forEach(concertSnapshot =&gt; {
            var concertVals = concertSnapshot.val();
            
            // Hent Scene etter key
            festivalSnapshot.ref.child(&quot;scenes&quot;).child(concertSnapshot.val().scene).once(&quot;value&quot;, foundScene =&gt; {
              if (foundScene.exists()) {
                var sceneName = foundScene.val().name;
                var sceneCapacity = foundScene.val().capacity;
                var genre = concertSnapshot.val().genres.split(&quot;,&quot;)[0]
  
                concertVals[&quot;sceneName&quot;] = sceneName;
                concertVals[&quot;sceneCapacity&quot;] = sceneCapacity;
                concertVals[&quot;genre&quot;] = genre;
              }
              
              concertVals[&quot;festivalName&quot;] = festivalSnapshot.val().name;
              // Tar vare p&#xE5; alle sjangre man finner
              if (!previousGenres.includes(genre)) {
                previousGenreOptions.push(
                  &lt;option id=&quot;dropdownItem&quot; value={genre} onClick={this.handleChange} key={concertSnapshot.key}&gt; {genre} &lt;/option&gt;
                )
                previousGenres.push(genre)
              }
            })
            .then(() =&gt; {
              festivalSnapshot.ref.child(&quot;program&quot;).child(concertSnapshot.val().date).once(&quot;value&quot;, programSnap =&gt; {
                programSnap.ref.child(&quot;slots&quot;).child(concertSnapshot.val().time).once(&quot;value&quot;, slotSnap =&gt; {
                  if (slotSnap.exists()) {
                    concertVals[&quot;startTime&quot;] = slotSnap.val().start
                    concertVals[&quot;endTime&quot;] = slotSnap.val().end
                    concertVals[&quot;dateVal&quot;] = programSnap.val().date
                  }
                })
              
              })
            })

            previousConcerts.push(concertVals);
          })
        }
      })
    })
    .then(() =&gt; {
      this.setState({
        genreOptions: previousGenreOptions,
        genres: previousGenres,
        concerts: previousConcerts,
      })
    })
  }

  /**
   * Renders the banddatabase page
   */
  render() {
    return (

      &lt;div className=&quot;container&quot;&gt;

        &lt;section className=&quot;jumbotron text-center&quot;&gt;
          &lt;div className=&quot;container&quot;&gt;
            &lt;h1 className=&quot;jumbotron-heading&quot;&gt;Concert Database&lt;/h1&gt;
            &lt;p className=&quot;lead text-muted&quot;&gt;all concerts from all festivals&lt;/p&gt;
            &lt;p&gt;
              &lt;input type=&quot;text&quot; class=&quot;form-control&quot; value={this.state.currentSearchInput} onChange={this.handleSearch} placeholder=&quot;Search for Artist...&quot; aria-label=&quot;Search for...&quot;/&gt;
            &lt;/p&gt;
            &lt;div id=&quot;concertDatabaseDrop&quot; className=&quot;dropdown&quot;&gt;
            &lt;button className=&quot;btn btn-secondary dropdown-toggle&quot; type=&quot;button&quot; id=&quot;dropdownMenuButton&quot; data-toggle=&quot;dropdown&quot; aria-haspopup=&quot;true&quot; aria-expanded=&quot;false&quot;&gt;
              {this.state.selectedGenre}
            &lt;/button&gt;
            &lt;div className=&quot;dropdown-menu&quot; aria-labelledby=&quot;dropdownMenuButton&quot;&gt;
              &lt;option id=&quot;dropdownItem&quot; onClick={this.handleChange} value={&quot;All Genres&quot;}  key=&quot;ShowAll&quot;&gt; All Genres &lt;/option&gt;
              {this.state.genreOptions}
            &lt;/div&gt;
            &lt;/div&gt;
          &lt;/div&gt;
        &lt;/section&gt;

        

        &lt;div id=&quot;accordion&quot; role=&quot;tablist&quot;&gt;
        {
          this.state.concerts.map((concert, concertNum) =&gt; {
            let match = false;

              // Hvis valgt er Show All s&#xE5; &quot;matcher&quot; alle
              if (this.state.selectedGenre === &quot;All Genres&quot;) {

                if (this.state.currentSearchInput === &quot;&quot;) {
                  match = true
                }

                else if (concert.name.toLowerCase().search(this.state.currentSearchInput.toLowerCase()) !== -1) {
                  match = true
                }
              }

              // Hvis ikke Show All, matcher valgt sjanger og konsertens sjanger?
              // Og matcher s&#xF8;ket og navnet?
              else if (this.state.selectedGenre == concert.genre) {
                if (this.state.currentSearchInput === &quot;&quot;) {
                  match = true
                }

                else if (concert.name.toLowerCase().search(this.state.currentSearchInput.toLowerCase()) !== -1) {
                  match = true
                }
              }

              if (match) {
                return (
                &lt;div className=&quot;card&quot; key={concert.key}&gt;
                  &lt;div className=&quot;card-header&quot; role=&quot;tab&quot; id={&quot;heading&quot;+concertNum}&gt;
                    &lt;h5 className=&quot;mb-0&quot;&gt;
                      &lt;a data-toggle=&quot;collapse&quot; href={&quot;#collapse&quot;+concertNum} aria-expanded=&quot;false&quot; aria-controls={&quot;collapse&quot;+concertNum}&gt;
                        &lt;span&gt;
                          &lt;p&gt; {concert.festivalName} - {concert.dateVal} &lt;/p&gt;
                          &lt;p&gt; {concert.name} &lt;/p&gt;
                          &lt;p&gt;  &lt;/p&gt;  
                        &lt;/span&gt;
                        
                      &lt;/a&gt;
                    &lt;/h5&gt;
                  &lt;/div&gt;
              
                  &lt;div id={&quot;collapse&quot;+concertNum} className=&quot;collapse&quot; role=&quot;tabpanel&quot; aria-labelledby={&quot;heading&quot;+concertNum}&gt;
                    &lt;div className=&quot;card-body&quot;&gt;
                      &lt;h6&gt;{concert.day}&lt;/h6&gt;
                      &lt;img src={concert.pic ? concert.pic : defaultArtistPic} className=&quot;rounded float-left&quot; alt=&quot;Bilde av artist&quot;/&gt;
                      &lt;div className=&quot;float-center&quot;&gt;
                        &lt;br&gt;&lt;/br&gt;
                        &lt;h6&gt; Genres: {concert.genres} &lt;/h6&gt;
                        &lt;h6&gt; Scene: {concert.sceneName} &lt;/h6&gt;
                        &lt;h6&gt; Scene Capacity: {concert.sceneCapacity} &lt;/h6&gt;
                        &lt;h6&gt; Technical Requirements : {concert.requirements ? concert.requirements : &quot;None&quot;} &lt;/h6&gt;
                        &lt;h6&gt; Rider: {concert.rider ? concert.rider : &quot;None&quot;} &lt;/h6&gt;
                      &lt;/div&gt;
                    &lt;/div&gt;
                  &lt;/div&gt;
                &lt;/div&gt;
              )
            }
          })
        }
        &lt;/div&gt;
      &lt;/div&gt;
    );
  }
}
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.0.4)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
